# HCiA

## 基本网络通信原理

### IP地址的格式

网络位+主机位

比如：

<font color=red>192.168.1</font>.1

另一个地址	192.168.1.x	和我在相同的网段

172. 16.100.2	和我不在相同的网段



由**子网掩码**决定网络位的长度

192.168.1.1	255.255.0.0 

*子网掩码有几段，就代表网络位有几位*

*比如192.168.1.1	255.255.255.0，代表192.168.1是网络位*

*又比如192.168.1.1	255.255.0.0，代表192.168是网络位*



## IP地址配置

——>ENSP

![image-20240509001056428](E:\华为\HICA\pic\image-20240509001056428.png)

AR1

```c
sy
int g0/0/0
ip add 192.168.1.1 255.255.255.0 //IP地址 + 掩码
```

AR2:

```c
sy
int g0/0/0
ip add 192.168.1.2 255.255.255.0 //IP地址 + 掩码
```

在AR1测试连通性

```
ping 192.168.1.2
```

![image-20240509001351593](E:\华为\HICA\pic\image-20240509001351593.png)



## DHCP

——>ENSP

![image-20240509002221305](E:\华为\HICA\pic\image-20240509002221305.png)

AR1：

```c
sy
int g0/0/0
ip add 192.168.1.1 255.255.255.0 //配置IP地址
q //返回主页面
dhcp enable //开启dhcp服务
int g0/0/0
dhcp select int //进入接口开通dhcp功能
```

PC端：

选择dhcp配置

![image-20240509002527853](E:\华为\HICA\pic\image-20240509002527853.png)

命令行查看地址	ipconfig



## DNS域名系统

www.baidu.com为域名，但是他们的服务器也是IP地址

需要一台DNS服务器，实现域名解析，把网址变成对应的IP地址

——>ENSP

![image-20240509095118499](E:\华为\HICA\pic\image-20240509095118499.png)

**server1：**

配置IP地址

![image-20240509102240215](E:\华为\HICA\\pic\image-20240509102240215.png)

添加域名和IP地址

![image-20240509102327756](E:\华为\HICA\pic\image-20240509102327756.png)

**AR1:**

开启DNS服务

```
int g0/0/0
dhcp server dns-list 192.168.1.100 //将server1地址添加
```

**PC：**

![image-20240509103226759](E:\华为\HICA\pic\image-20240509103226759.png)



## 路由技术基础

网关：用来连接不同的网段

——>ENSP

![image-20240509104336316](E:\华为\HICA\pic\image-20240509104336316.png)

**PC3：**

![image-20240509104351796](E:\华为\HICA\pic\image-20240509104351796.png)

**AR1**

```c
int g0/0/1
ip add 100.100.100.1 255.255.255.0
```

测试连通性

![image-20240509104711123](E:\华为\HICA\pic\image-20240509104711123.png)



## 静态路由

——>ENSP

![image-20240509112555030](E:\华为\HICA\pic\image-20240509112555030.png)

基础配置地址：略

静态路由：

**AR1**：

```c
ip route-static 192.168.3.0 255.255.255.0 192.168.2.10
//格式：要进入的网段 掩码  下一跳地址
```

**AR2:**

```
ip route-static 192.168.1.0 255.255.255.0 192.168.2.1
//格式：要进入的网段 掩码  下一跳地址
```

测试连通性

![image-20240509112841754](E:\华为\HICA\pic\image-20240509112841754.png)



## vlan虚拟局域网

### 网络安全

涵盖技术：vlan、acl（访问控制链表）



#### vlan（隔离技术）

通常用法：

先用vlan把用户隔离开，再用三层交换技术，把隔离开的用户连起来

隔离：隔离是故障

连通：是正常通信

交换机的接口模式

Access：用来连接终端，例如：电脑、打印机

Trunk：用来连接其他交换机

 ——>ENSP

![image-20240511154426330](E:\华为\HICA\pic\image-20240511154426330.png)

由于两台PC通过交换机连接，测试连通性

![image-20240511154453616](E:\华为\HICA\pic\image-20240511154453616.png)

通过vlan，实现隔离

**SW1**

```c
vlan 10 //创建vlan 10
q
vlan 20 //创建vlan 20
q
int g0/0/1
port link-type aceess
port default vlan 10
q
int g0/0/2port link-type aceess
port default vlan 20
```

再测试连通性

![image-20240511155337307](E:\华为\HICA\pic\image-20240511155337307.png)

### 三层交换技术

——>ENSP

![image-20240511160412578](E:\华为\HICA\pic\image-20240511160412578.png)

**SW1**

```
vlan 10 //创建vlan 10
q
vlan 20 //创建vlan 20
q
int g0/0/1
port link-type aceess
port default vlan 10
q
int g0/0/2port link-type aceess
port default vlan 20
int g0/0/3
port link-type trunk
port trunk allow-pass vlan all
```

**SW2**

```
vlan 10
vlan 20
int g0/0/1
port link-type trunk
port trunk allow-pass vlan all
int vlanif 10
ip add 1.1.1.254 255.255.255.0
int vlanif 20
ip add 2.2.2.254 255.255.255.0
```

测试连通性

![image-20240511160646021](E:\华为\HICA\pic\image-20240511160646021.png)

![image-20240511160728028](E:\华为\HICA\pic\image-20240511160728028.png)



## ACL访问控制列表

步骤一：创建一个访问控制规则

步骤二：调用这个规则

——>ENSP

![image-20240511162927675](E:\华为\HICA\pic\image-20240511162927675.png)



要求PC1不能ping通PC3，但其他不影响

其他配置略

**SW2**

```
acl name test advance
rule deny ip source 192.168.10.0 0.0.0.255 destination 192.168.30.0 0.0.0.255 //
rule permit ip source any destination any 
```

**SW1**

```
//在数据包必经的接口调用这条规则
traffic-filter inbound acl name test
```

测试连通性

![image-20240511163547734](E:\华为\HICA\pic\image-20240511163547734.png)



## NAT网络地址转换

如何连接互联网

1、路由怎么也写

​	  写缺省路由：ip route 0.0.0.0 0.0.0.0 下一跳

2、NAT网络地址转换

​	  PC/手机在内网，用私网地址

​	  必须转换成公网地址

私网常见地址：

192.168.x.x

10.x.x.x

172.16.x.x  到  172.31.x.x




——>ENSP

![image-20240511165335257](E:\华为\HICA\pic\image-20240511165335257.png)

IP配置略

**AR1**

```c
acl name neiwang basic
rule  permit source 192.168.0.0  0.0.255.255
nat address-group 1 64.1.1.2 64.1.1.6
int g0/0/1
nat outbound 2999 address-group 1
```

测试连通性

![image-20240511165549416](E:\华为\HICA\pic\image-20240511165549416.png)



如何管理网络设备

telnet



## 网络参考模型



### OSI参考模型

![image-20240511232035488](E:\华为\HICA\pic\image-20240511232035488.png)

​	应用层：是面向用户的APP，承载用户的数据，微信聊天的文字、图片，抖音观看的视频等都属于应用层数据

​	表示层：计算机用自己的编码方式，对用户的数据进行编码。如用JPEG编码方式来表示各种图片数据，用MP3编码方式来表述各种声音数据。当然，某公司为了安全起见，也可以独创一套只有自己才能识别的编码方式来表示数据。

​	会话层：两个程序之间的接口。如美团APP可以调用微信支付，就是用过二者之间的会话层接口。

​	传输层：用于建立TCP或UDP连接，并给数据报文打上端口号。

​	TCP或UDP的连接区别是，TCP传输可靠性高但是速度慢延迟高，UDP刚好相反。根据不同的应用场景按需选择。

​	给报文打赏端口号的作用是，接收方可以以识别报文属于什么应用程序，如80是网页的数据，4000是QQ的数据。

​	网络层：给数据包打上IP地址，用于路由转发。有了IP地址，网络设备才知道数据包应该发往互联网上的哪个位置。

​	数据链路层：建立逻辑连接、进行硬件地址寻址、差错效验等功能。(由底层网络定义协议)

将比特组合成字节进而组合成帧，用MAC地址访问介质，错误发现但不能纠正。

​	物理层：建立、维护、断开物理连接。(由底层网络定义协议)

### 各层常见协议

**应用层**

HTTP：超文本传输协议，提供浏览网页服务

Telnet：远程登录协议，提供远程管理服务

FTP：文件传输协议，提供互联网文件资源共享服务

SMTP：简单邮件传输协议，提供互联网电子邮件服务 

TFTP：简单文件传输协议，提供简单的文件传输服务



**传输层**

TCP：为应用程序提供可靠的面向连接的通信服务

UDP：提供了无连接通信，切不对传送数据包进行可靠性的保证



**网络层**

IP：将传输层的数据封装成数据包并完成源站点到目的站点的转发，提供无连接的、不可靠的服务

IGMP：负责IP组播成员管理的协议。它用来在IP主机和与其直接相邻的组播路由器之间建立、维护组播组成员关系

ICMP：基于IP协议在网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈。通过这些信息，使管理者可以对所发生的问题作出诊断，然后采取适当的措施解决

**数据链路层**

Ethernet：一种多路访问广播型数据链路层协议，是当前应用最为广泛的局域网技术

PPP：一种点对点模式的数据链路层协议，多用于广域网

PPPoE（Point-to-Point Protocol over Ethernet，以太网承载PPP协议）：常见的应用有家庭宽带拨号上网



#### TCP和UDP报头

TCP报文头部：

Source Port：源端口，标识哪个应用程序发送。长度为16比特、

Destination Port：目的端口，标识哪个应用程序接收。长度为16比特。

以浏览网页的时候，客户端（网页浏览器）向服务器（网站）请求下载网页为例，

客户端向服务器发了一个请求报文，这个报文的源端口是客户端网页浏览器的端口，目标端口就是网站的web服务软件。

![image-20240512122503234](E:\华为\HICA\pic\image-20240512122503234.png)

Sequence Number：序号字段。TCP链接中的每个报文都有序列号。长度为32比特。

Acknowledgment Number：确认号，用于对收到的报文的确认。

Header Length：头部长度，TCP报文头部长度，默认情况下，TCP头部为20字节。

Control bits：控制位，包含FIN、ACK、SYN等标志位。

Window：窗口TCP的流量控制，这个值表明当前接收端可接受的最大的数据总数（以字节为单位）。窗口最大为65535字节。长度为16比特。

Checksum：校验字段，由发端计算和存储，并由收端进行验证，用于校验数据传输中是否有损坏。



UDP报文头部：

Source Port：源端口，标识哪个应用程序发送。长度为16比特。

Destination Port：目的端口，标识哪个应用程序接收。长度为16比特。

Length：报文总长度。



## IP协议原理

### IPv4

#### IPv4报文格式

![image-20240512144329135](E:\华为\HICA\pic\image-20240512144329135.png)

IP Packet（IP数据包），其包头主要内容入下：

Version：4 bit，4：表示为IPv4；6：表示为IPv6

Header Length：4 bit，首部长度，如果不带Option字段，则为20，最长为60。

Type of Service：8 bit，服务类型。只有在有QoS差分服务要求时，这个字段才起作用。

Total Length：16 bit，总长度，整个IP数据包的长度。

Identification：16 bit，标识，分片重组时会用到该字段。

Flags：3 bit，标志位

Fragment Offset：12 bit，片偏移，分片重组时会用到该字段

Time to Live： 8 bit，生存时间。   

Protocol ：8 bit，协议：下一层协议。指出此数据包携带的数据使用何种协议，以便目的主机的IP层将数据部分上交给哪个进程处理。

Header Checksun：16 bit，首部校验和。校验，判断数据包传输的时候是否有损坏。

Source IP Address：32 bit，源IP地址。

Destination IP Address：32 bit，目的IP地址。

Option：可变，选项字段。

 

#### IP地址

​	IP地址长度是32bit，为了阅读和书写方便，IP地址通常采用点分十进制数来表示。

​	IP地址表现形式能够帮助我们更好的使用和配置网络，但通信设备在对IP地址进行计算时使用的是二进制的操作方式。

​	IPv4地址范围

​	00000000.00000000.00000000.00000000到11111111.11111111.11111111.11111111，换成十进制即0.0.0.0~255.255.255.255.



为了方便IP地址的管理及组网，IP地址分成五类

![image-20240512152501957](E:\华为\HICA\pic\image-20240512152501957.png)

A/B/C类默认网络掩码

- A类：8 bit，    0.0.0.0~127.255.255.255/8
- B类：16 bit ，    128.0.0.0~191.255.255.255/16
- C类：32 bit，    192.0.0.0~223.223.255.255/24



#### IP地址构成

 ![image-20240512153811466](E:\华为\HICA\pic\image-20240512153811466.png)

不可用地址：网络地址和广播地址不能直接被节点或者网络设备所使用



#### 私网IP地址

**公网IP地址**：IP地址是由IANA统一分配的，以保证任何一个IP地址在Internet上的唯一性。这里的IP地址是指公网IP地址。

**私网IP地址**：实际上一些网络不需要连接到Internet，比如一个大学的封闭实验室内的网络，只要同一网络中的网络设备的IP地址不冲突即可。在IP地址空间里，A、B、C三类地址中各预留了一些地址专门用于上述情况，成为私网IP地址。

- A类：10.0.0.0~10.255.255.255
- B类：172.10.0.0~172.31.255.255
- C类：192.168.0.0~192.168.255.255



#### 特殊IP地址

IP地址空间中，有一些特殊的IP地址，这些IP地址有特殊的含义和作用，举例如下：

![image-20240512155149664](E:\华为\HICA\pic\image-20240512155149664.png)



#### IPv4 vs IPv6

由全球IP地址分配机构，IANA（Internet Assigned Number Authority）管理的IPv4地址，于2011年完全用尽。随着最后一个IPv4公网地址分配完毕，加上接入公网的用户及设备越来越多，IPv4地址枯竭的问题日益严重，这是当前IPv6替代IPv4的最大源动力。

![image-20240512155451907](E:\华为\HICA\pic\image-20240512155451907.png)

### 子网划分

#### ICMP协议

![image-20240512163248311](E:\华为\HICA\pic\image-20240512163248311.png)

- Internet控制消息协议ICMP（Internet Control Message Protocol）是IP协议的辅助协议。
- ICMP协议用来在网络设备间传递各种差错和控制信息，对于收集各种网络信息、诊断和排除各种网络故障等方面起着至关重要的作用。

#### ICMP重定向

ICMP重定向报文是ICMP控制报文中的一种。在特定的情况下，当路由器检测到一台机器使用非最优路由的时候，他会向该主机发送一个ICMP重定向报文，请求主机改变路由。

![image-20240512163544101](E:\华为\HICA\pic\image-20240512163544101.png)

## 路由基础和静态路由

 ### 路由信息获取方式

![image-20240512170724204](E:\华为\HICA\pic\image-20240512170724204.png)

​	**直连**：只要路由器的某个接口配置了iP地址，生效；自动产生一个相关的直连路由条目，比如：接口配的地址2.2.2.1 24，自动出现一个和这个接口对应2.2.2.0 24

​	**动态**：OSPF、RIP、ISIS

​	**Pre（Preference）**：表示此路由的路由协议优先级。针对同一目的地，可能存在不同下一条、出接口等多条路由，这些不同的路由可能是由不同的路由协议发现的，也可以是手工配置的静态路由。优先级最高（数值最小）者将成为当前的最优路由。

​	**Cost**：路由开销。当到达同一目的地的多条路由具有相同的路由优先级时，路由开销最小的将成为当前的最有路由。

​	**路由优先级的比较过程：两条路由，首先比较路由的掩码。掩码长的优先，再比较pre，如果pre相同，继续比较cost， 越小越优，如果都相同，则形成等价路由**

​	**NextHop**：表示对于本路由器而言，到达该路由指向的目的网络的下一跳地址。该字段指明了数据转发的下一个设备。

​	**Interface**：表示此路由的出接口。指明数据将从本路由器的哪个接口转发出去。

	### 动态路由分类

![image-20240512173336739](E:\华为\HICA\pic\image-20240512173336739.png)

#### 缺省路由

* 缺省路由是一种特殊的路由，当保温没有在路由表中找到匹配的具体路由表项时才使用的路由。如果报文的目的地址不能与路由表的任何目的地址相匹配，那么该报文将选取缺省路由进行转发。  

![image-20240512173604919](E:\华为\HICA\pic\image-20240512173604919.png)

![image-20240512174928785](E:\华为\HICA\pic\image-20240512174928785.png)

 

## OSPF

	### OSPF简介

​	OSPF是典型的链路状态路由协议，是目前业内使用非常广泛的IGP协议之一。

​	目前针对IPv4协议使用的是OSPF Version 2（RFC2328）；针对IPv6协议使用OSPF Version 3（RFC2740）。

​	**OSPF基本概念**

​	Route-ID（Route Identify，路由器标识符），用于在一个OSPF域中唯一地标识一台路由器。Route-ID的设定可以通过手工配置的方式，或使用系统自动配置的方式。

​	OSPF Area 用于标识一个OSPF的区域。

​	区域是从逻辑上将设备划分为不同的组，每个组用区域号（Area ID）来标识。

​	Cost：OSPF使用Cost（开销）作为路由的度量值。每一个激活了OSPF的接口都会维护一个接口的Cost值，缺省时接口Cost值=”100 Mbit/s“  /  ”接口带宽“。其中100 ”mbit/s“为OSPF指定的缺省参考值，该值是可配置的。

​	笼统的说，一条OSPF路由的Cost值可以理解为是从目的网段到本路由器沿途所有入接口的Cost值累加。



### OSPF工作原理

​	OSPF的5种报文

| 报文名称             | 报文功能                                                     |
| -------------------- | ------------------------------------------------------------ |
| Hello                | 周期性发送，用来发现和维护OSPF邻居关系                       |
| Database Description | 描述本地LSDB的摘要信息，用于两台设备进行数据库同步           |
| Link State Request   | 用于向对方请求所需要的LSA。设备只有在OSPF邻居双方成功交换DD报文后才会相对方发出LSR报文 |
| Link State Update    | 用于向对方发送器所需要的LSA                                  |
| Link State ACK       | 用来对收到的LSA进行确认                                      |

​	OSPF的3张表

​	OSPF的工作过程分为3个大步骤，分别是形成邻居关系。形成邻接关系，计算路由。

​	OSPF建立邻居，收集LSA，收集完成行程邻接

用收集到的LSA，作为原材料，计算路由

有路由了

​	完成这3个大步骤，分别会形成3张表，分别是OSPF邻居表、LSDB表和OSPF路由表。

![image-20240512210921094](E:\华为\HICA\pic\image-20240512210921094.png)

![image-20240512210925631](E:\华为\HICA\pic\image-20240512210925631.png)

![image-20240512210937030](E:\华为\HICA\pic\image-20240512210937030.png)

——>ENSP

![image-20240512211123847](E:\华为\HICA\pic\image-20240512211123847.png)

**AR3**

```c
ospf 1 router-id 1.1.1.1
area 0
net 192.168.2.0 0.0.0.255
net 192.168.1.0 0.0.0.255
```

**AR4**

```c
ospf 1 router-id 2.2.2.2
area 0
net 192.168.2.0 0.0.0.255
net 192.168.3.0 0.0.0.255
```

 

​	OSPF邻接关系建立流程

![image-20240512211653540](E:\华为\HICA\pic\image-20240512211653540.png)

![image-20240512211658793](E:\华为\HICA\pic\image-20240512211658793.png)

![image-20240512211703498](E:\华为\HICA\pic\image-20240512211703498.png)

OSPF路由器类型

![image-20240512214330843](E:\华为\HICA\pic\image-20240512214330843.png)
